<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">










<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
<meta http-equiv="Content-Language" content="ja" /> 
<meta http-equiv="Content-Style-Type" content="text/css" /> 
<title>Doma - 検索</title>
<link rel="stylesheet" type="text/css" href="http://www.seasar.org/theme/main.css" media="screen,projection" />
<link rel="stylesheet" type="text/css" href="http://www.seasar.org/theme/print.css" media="print" />
<link href="../css/maven-base.css" type="text/css" rel="stylesheet" media="screen" />
<link href="../css/maven-theme.css" type="text/css" rel="stylesheet" media="screen" />
<link href="../css/prettify.css" type="text/css" rel="stylesheet" media="screen" />
<script type="text/javascript" src="../js/prettify.js"></script>
</head>

<body onload="prettyPrint()">

<div id="wrapper">

<div id="header">

<div class="line"><span class="hide">spacer</span></div>

<div id="logo"><h1 id="h01" class="hide">The Seasar Project</h1><a href="http://www.seasar.org/" alt="The Seasar Project" title="The Seasar Project"><img src="http://www.seasar.org/images/seasar_logo_blue.gif" alt="The Seasar Project" width="390" height="180" /></a></div>

<div id="tool">

<h2><a href="http://search.seasar.org/">Site Search</a></h2>

<form id="search" action="http://search.seasar.org/">
<div>
	<input id="search_phrase" type="text" name="phrase" size="20" />
	<input type="hidden" name="perpage" value="30" />
	<input type="hidden" name="enc" value="UTF-8" />
	<input id="search_go" type="submit" value="Search" />
</div>
</form>

<h2>Seasar Banner</h2>
            <a href="http://www.seasar.org/" id="bannerLeft">
    
                                    <img src="http://www.seasar.org/images/seasar_banner.gif" alt="" />
    
            </a>
      
</div>

<div id="navi">
	<p id="navi_left">  
          <a href="http://www.seasar.org/">Seasar</a>
              &gt;
      
          <a href="../index.html">Doma</a>
          </p>
	<p id="navi_right"><a href="../../en/">English</a> | <a href="../../ja/">Japanese</a></p>
</div>

</div><!-- header -->

<div id="contents_left">
           
  

  
    
  
  
                   <h2>About</h2>
        <ul>
              
    <li class="none">
              <a href="../index.html">ホーム</a>
        </li>
              
    <li class="none">
              <a href="../overview.html">概要</a>
        </li>
              
    <li class="none">
              <a href="../downloads.html">ダウンロード</a>
        </li>
              
    <li class="none">
              <a href="https://www.seasar.org/issues/browse/DOMA">課題追跡</a>
        </li>
              
    <li class="none">
              <a href="https://www.seasar.org/issues/browse/DOMA#selectedTab=com.atlassian.jira.plugin.system.project%3Achangelog-panel">変更履歴</a>
        </li>
              
    <li class="none">
              <a href="https://ml.seasar.org/mailman/listinfo/seasar-user">メーリングリスト</a>
        </li>
              
    <li class="none">
              <a href="../faq.html">よくある質問</a>
        </li>
          </ul>
          <h2>ドキュメント</h2>
        <ul>
              
    <li class="none">
              <a href="../setup.html">セットアップ</a>
        </li>
              
    <li class="none">
              <a href="../quick_start.html">クイックスタート</a>
        </li>
              
                
              
            
            
      
            
      
            
      
              
            <li class="expanded">
              <a href="../tutorial/index.html">チュートリアル</a>
                <ul>
                  
    <li class="none">
              <strong>検索</strong>
        </li>
                  
    <li class="none">
              <a href="../tutorial/insert.html">挿入</a>
        </li>
                  
    <li class="none">
              <a href="../tutorial/update.html">更新</a>
        </li>
                  
    <li class="none">
              <a href="../tutorial/delete.html">削除</a>
        </li>
              </ul>
        </li>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
                  
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
              <a href="../reference/index.html">リファレンス</a>
              </li>
              
    <li class="none">
              <a href="../jpetstore.html">デモアプリ - Doma JPetStore</a>
        </li>
              
                
              
      
            
      
            
      
            
      
                    
        <li class="collapsed">
              <a href="../extension/index.html">開発支援ツール</a>
              </li>
              
    <li class="none">
              <a href="http://www.seasar.org/wiki/index.php?DomaUpdateOperationLog">移行ガイド</a>
        </li>
          </ul>
          <h2>Javadocs</h2>
        <ul>
              
    <li class="none">
              <a href="../apidocs/index.html">Doma</a>
        </li>
              
    <li class="none">
              <a href="../extension/doma-gen/apidocs/index.html">Doma-Gen</a>
        </li>
          </ul>
          <h2>プロジェクト文書</h2>
        <ul>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
              <a href="../project-info.html">プロジェクト情報</a>
              </li>
          </ul>
                                       <a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy" name="poweredBy">
            <img alt="Built by Maven" src="../images/logos/maven-feather.png" />
          </a>
                       
  

  
    
  
  
  </div><!-- contents_left -->

<div id="contents_center">

<div id="article">
<div class="section"><h2><a name="目次"></a>目次</h2>
<ul><li><a href="#概要">概要</a></li>
<li><a href="#単純な検索">単純な検索</a></li>
<li><a href="#条件分岐を用いた検索">条件分岐を用いた検索</a></li>
<li><a href="#条件分岐でelseを用いた検索">条件分岐でelseを用いた検索</a></li>
<li><a href="#繰り返しを用いた検索">繰り返しを用いた検索</a></li>
<li><a href="#IN述語による検索">IN述語による検索</a></li>
<li><a href="#LIKE述語による検索">LIKE述語による検索</a><ul><li><a href="#前方一致検索">前方一致検索</a></li>
<li><a href="#後方一致検索">後方一致検索</a></li>
<li><a href="#中間一致検索">中間一致検索</a></li>
</ul>
</li>
<li><a href="#日付による範囲検索">日付による範囲検索</a></li>
<li><a href="#文字シーケンスを組み込み関数で判定する検索">文字シーケンスを組み込み関数で判定する検索</a></li>
<li><a href="#ドメインによる検索">ドメインによる検索</a></li>
<li><a href="#エンティティによる検索">エンティティによる検索</a></li>
<li><a href="#ページングを行う検索">ページングを行う検索</a></li>
<li><a href="#ページングと集計を同時に行う検索">ページングと集計を同時に行う検索</a></li>
<li><a href="#イテレーション検索">イテレーション検索</a></li>
<li><a href="#結合した結果を取得する検索">結合した結果を取得する検索</a></li>
</ul>
</div>
<div class="section"><h2><a name="概要"></a>概要</h2>
<p>
				検索は、すべて外部化されたSQLを使って行われます。
			</p>
<p>
				外部化されたSQLはすべてバインド変数（?）を使った準備された文に変換されて実行されますが、
				このドキュメントでは、発行されたSQLがどのようなものかわかりやすくするためにバインド変数を実際の値に置き換えたログ用のSQLを示します。
			</p>
</div>
<div class="section"><h2><a name="単純な検索"></a>単純な検索</h2>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestSimpleSelectメソッドを参照してください。
				引数をSQLファイルにバインディングして実行する単純な検索です。
				バインディングには<a href="../reference/sqlfile.html#バインド変数コメント">バインド変数コメント</a>を使用します。
			</p>
<p>
				使用するDaoのメソッド定義は次のとおりです。
			</p>
<div class="source"><pre>@Select
Employee selectById(Integer id);</pre>
</div>
<p>
				Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectById.sqlです。SQLは次のように記述されています。
			</p>
<div class="source"><pre>select * from employee where id = /* id */0</pre>
</div>
<p>
				Daoのメソッドは次のように呼び出します。
			</p>
<div class="source"><pre>Employee employee = dao.selectById(1);</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee where id = 1</pre>
</div>
</div>
<div class="section"><h2><a name="条件分岐を用いた検索"></a>条件分岐を用いた検索</h2>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestConditinalSelectメソッドを参照してください。
				SQLファイル中に<a href="../reference/sqlfile.html#条件コメント">条件コメント</a>を記述することで動的なSQLを発行できます。
			</p>
<p>
				使用するDaoのメソッド定義は次のとおりです。
			</p>
<div class="source"><pre>@Select
List&lt;Employee&gt; selectByAgeRange(Integer min, Integer max);</pre>
</div>
<p>
				Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectByAgeRange.sqlです。SQLは次のように記述されています。
			</p>
<div class="source"><pre>select * from employee
where
/*%if min != null */
  age &gt;= /* min */10
/*%end */
/*%if max != null */
  and
  age &lt;= /* max */70
/*%end */
order by age</pre>
</div>
<div class="section"><h3><a name="条件1"></a>条件1</h3>
<p>
				1番目のパラメータに30、2番目のパラメータに40を渡してDaoのメソッドを呼び出します。
			</p>
<div class="source"><pre>List&lt;Employee&gt; list = dao.selectByAgeRange(30, 40);</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee
where
  age &gt;= 30
  and
  age &lt;= 40
order by age</pre>
</div>
</div>
<div class="section"><h3><a name="条件2"></a>条件2</h3>
<p>
				1番目のパラメータに30、2番目のパラメータにnullを渡してDaoのメソッドを呼び出します。
			</p>
<div class="source"><pre>list = dao.selectByAgeRange(30, null);</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee
where
  age &gt;= 30
order by age</pre>
</div>
</div>
<div class="section"><h3><a name="条件3"></a>条件3</h3>
<p>
				1番目のパラメータにnull、2番目のパラメータに40を渡してDaoのメソッドを呼び出します。
			</p>
<div class="source"><pre>list = dao.selectByAgeRange(null, 40);</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee
where
  age &lt;= 40
order by age</pre>
</div>
</div>
<div class="section"><h3><a name="条件4"></a>条件4</h3>
<p>
				1番目のパラメータにnull、2番目のパラメータにnullを渡してDaoのメソッドを呼び出します。
			</p>
<div class="source"><pre>list = dao.selectByAgeRange(null, null);</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee
order by age</pre>
</div>
</div>
</div>
<div class="section"><h2><a name="条件分岐でelseを用いた検索"></a>条件分岐でelseを用いた検索</h2>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestConditinalSelect2メソッドを参照してください。
				SQLファイル中に<a href="../reference/sqlfile.html#条件コメント">条件コメント</a>を記述することで動的なSQLを発行できますが、条件が成り立たない場合を /*%else*/ という式コメントで記述できます。
			</p>
<p>
				使用するDaoのメソッド定義は次のとおりです。
			</p>
<div class="source"><pre>@Select
List&lt;Employee&gt; selectByName(String name);</pre>
</div>
<p>
				Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectByName.sqlです。SQLは次のように記述されています。
			</p>
<div class="source"><pre>select * from employee
where 
/*%if name != null*/
  name = /*name*/'hoge'
/*%else */
  and
  name is null
/*%end */</pre>
</div>
<div class="section"><h3><a name="条件1"></a>条件1</h3>
<p>
				パラメータに&quot;SMITH&quot;を渡してDaoのメソッドを呼び出します。
				この場合、name != null という条件が成り立ちます。
			</p>
<div class="source"><pre>List&lt;Employee&gt; list = dao.selectByName(&quot;SMITH&quot;);</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee
where 
  name = 'SMITH'</pre>
</div>
</div>
<div class="section"><h3><a name="条件2"></a>条件2</h3>
<p>
				パラメータにnullを渡してDaoのメソッドを呼び出します。
				この場合、name != null という条件は成り立ちません。
			</p>
<div class="source"><pre>list = dao.selectByName(null);</pre>
</div>
<p>
				SQLのログは次のように出力されます。where句の直後のandは自動で除去されます。
			</p>
<div class="source"><pre>select * from employee
where 
  
  name is null</pre>
</div>
<p>
  					elseだけではなくelseifを表すこともできます。
  					詳細は<a href="../reference/sqlfile.html#elseifとelse">elseifとelse</a>を参照してください。
  				</p>
</div>
</div>
<div class="section"><h2><a name="繰り返しを用いた検索"></a>繰り返しを用いた検索</h2>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestLoopSelectメソッドを参照してください。
				SQLファイル中に<a href="../reference/sqlfile.html#繰り返しコメント">繰り返しコメント</a>を記述することで、動的なSQLを発行できます。
			</p>
<p>
				使用するDaoのメソッド定義は次のとおりです。
			</p>
<div class="source"><pre>@Select
List&lt;Employee&gt; selectByAges(List&lt;Integer&gt; ages);</pre>
</div>
<p>
				Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectByAges.sqlです。SQLは次のように記述されています。
				次の要素がある場合にのみ表示したい文字列（この例ではor）は、<a href="../reference/sqlfile.html#埋め込み変数コメント">埋め込み変数コメント</a>で表します。
			</p>
<div class="source"><pre>select * from employee where 
/*%for age : ages */
  age = /* age */30
  /*%if age_has_next */
  /*# &quot;or&quot; */
  /*%end */
/*%end */</pre>
</div>
<p>
				Daoのメソッドは次のように呼び出します。
			</p>
<div class="source"><pre>List&lt;Integer&gt; ages = Arrays.asList(30, 40, 50, 60);
List&lt;Employee&gt; list = dao.selectByAges(ages);</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee where 
  age = 30
  or
  age = 40
  or
  age = 50
  or
  age = 60;</pre>
</div>
</div>
<div class="section"><h2><a name="IN述語による検索"></a>IN述語による検索</h2>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestInPredicateメソッドを参照してください。
				IN述語を使った検索です。
			</p>
<p>
				使用するDaoのメソッド定義は次のとおりです。
			</p>
<div class="source"><pre>@Select
List&lt;Employee&gt; selectByNames(List&lt;String&gt; names);</pre>
</div>
<p>
				Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectByNames.sqlです。SQLは次のように記述されています。
			</p>
<div class="source"><pre>select * from employee where name in /* names */('aaa', 'bbb')'</pre>
</div>
<p>
				Daoのメソッドは次のように呼び出します。
			</p>
<div class="source"><pre>List&lt;String&gt; names = Arrays.asList(&quot;JONES&quot;, &quot;SCOTT&quot;, &quot;XXX&quot;);
List&lt;Employee&gt; list = dao.selectByNames(names);</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee where name in ('JONES', 'SCOTT', 'XXX')</pre>
</div>
</div>
<div class="section"><h2><a name="LIKE述語による検索"></a>LIKE述語による検索</h2>
<div class="section"><h3><a name="前方一致検索"></a>前方一致検索</h3>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestLikePredicate_prefixメソッドを参照してください。
					SQLファイル中で<a href="../reference/sqlfile.html#組み込み関数の使用">組み込み関数</a>「@prefix()」を使用した前方一致検索ができます。
					組み込み関数「@prefix()」を使用するとJavaのコード内で「%」を文字列に連結する処理が不要になります。
				</p>
<p>
					使用するDaoのメソッド定義は次のとおりです。
				</p>
<div class="source"><pre>@Select
List&lt;Employee&gt; selectByNameWithPrefixMatching(String prefix);</pre>
</div>
<p>
					Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectByNameWithPrefixMatching.sqlです。SQLは次のように記述されています。
				</p>
<div class="source"><pre>select * from employee where name like /* @prefix(prefix) */'X%' escape '$'</pre>
</div>
<p>
					Daoのメソッドは次のように呼び出します。
				</p>
<div class="source"><pre>List&lt;Employee&gt; list = dao.selectByNameWithPrefixMatching(&quot;S&quot;);</pre>
</div>
<p>
					SQLのログは次のように出力されます。
				</p>
<div class="source"><pre>select * from employee where name like 'S%' escape '$'</pre>
</div>
</div>
<div class="section"><h3><a name="後方一致検索"></a>後方一致検索</h3>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestLikePredicate_suffixメソッドを参照してください。
					SQLファイル中で組み込み関数「@suffix()」を使用した後方一致検索ができます。
					組み込み関数「@suffix()」を使用するとJavaのコード内で「%」を文字列に連結する処理が不要になります。
				</p>
<p>
					使用するDaoのメソッド定義は次のとおりです。
				</p>
<div class="source"><pre>@Select
List&lt;Employee&gt; selectByNameWithSuffixMatching(String suffix);</pre>
</div>
<p>
					Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectByNameWithSuffixMatching.sqlです。SQLは次のように記述されています。
				</p>
<div class="source"><pre>select * from employee where name like /* @suffix(suffix) */'%X' escape '$'</pre>
</div>
<p>
					Daoのメソッドは次のように呼び出します。
				</p>
<div class="source"><pre>List&lt;Employee&gt; list = dao.selectByNameWithSuffixMatching(&quot;S&quot;);</pre>
</div>
<p>
					SQLのログは次のように出力されます。
				</p>
<div class="source"><pre>select * from employee where name like '%S' escape '$'</pre>
</div>
</div>
<div class="section"><h3><a name="中間一致検索"></a>中間一致検索</h3>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestLikePredicate_insideメソッドを参照してください。
					SQLファイル中で組み込み関数「@contain()」を使用した中間一致検索ができます。
					組み込み関数「@contain()」を使用するとJavaのコード内で「%」を文字列に連結する処理が不要になります。
				</p>
<p>
					使用するDaoのメソッド定義は次のとおりです。
				</p>
<div class="source"><pre>@Select
List&lt;Employee&gt; selectByNameWithInsideMatching(String inside);</pre>
</div>
<p>
					Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectByNameWithInsideMatching.sqlです。SQLは次のように記述されています。
				</p>
<div class="source"><pre>select * from employee where name like /* @contain(inside) */'%X%' escape '$'</pre>
</div>
<p>
					Daoのメソッドは次のように呼び出します。
				</p>
<div class="source"><pre>List&lt;Employee&gt; list = dao.selectByNameWithInsideMatching(&quot;A&quot;);</pre>
</div>
<p>
					SQLのログは次のように出力されます。
				</p>
<div class="source"><pre>select * from employee where name like '%A%' escape '$'</pre>
</div>
</div>
</div>
<div class="section"><h2><a name="日付による範囲検索"></a>日付による範囲検索</h2>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestSelectByTimestampRangeメソッドを参照してください。
				日付を用いて範囲検索を行う場合に、日付の時刻部分を切り捨てたり、日付を一日後ろへずらして切りのいい値にしたいことがあります。
				そのような場合には、<a href="../reference/sqlfile.html#組み込み関数の使用">組み込み関数</a>の「@roundDownTimePart()」と「@roundUpTimePart()」を使用します。
			</p>
<p>
				使用するDaoのメソッド定義は次のとおりです。
			</p>
<div class="source"><pre>@Select
List&lt;Employee&gt; selectByHiredateRange(Timestamp from, Timestamp to);</pre>
</div>
<p>
					Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectByHiredateRange.sqlです。SQLは次のように記述されています。
				</p>
<div class="source"><pre>select * from employee 
where 
  hiredate &gt;= /* @roundDownTimePart(from) */'2001-01-01 12:34:56'
  and 
  hiredate &lt; /* @roundUpTimePart(to) */'2001-01-01 12:34:56'</pre>
</div>
<p>
				Daoのメソッドは次のように呼び出します。
			</p>
<div class="source"><pre>Timestamp from = Timestamp.valueOf(&quot;2008-01-20 12:34:56&quot;);
Timestamp to = Timestamp.valueOf(&quot;2008-03-20 12:34:56&quot;);
List&lt;Employee&gt; list = dao.selectByHiredateRange(from, to);</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee 
where 
  hiredate &gt;= '2008-01-20 00:00:00.0'
  and 
  hiredate &lt; '2008-03-21 00:00:00.0'</pre>
</div>
<p>
				Javaコードからの引数と比べると時刻部分の切り捨てや切り上げが行われていることがわかります。
			</p>
</div>
<div class="section"><h2><a name="文字シーケンスを組み込み関数で判定する検索"></a>文字シーケンスを組み込み関数で判定する検索</h2>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestIsNotEmptyFunctionメソッドを参照してください。
			</p>
<p>
				文字シーケンスがnullかどうか、長さが0かどうかといった条件を基に条件分岐したい場合があります。たとえば、「nullでなくかつ長さが0でない場合にのみ検索条件に含める」には、次のようなSQLを記述できます。
			</p>
<div class="source"><pre>select * from employee where /*%if name != null &amp;&amp; name.length != 0 */ name = /* name */'hoge' /*%end*/</pre>
</div>
<p>
				しかし、上記のように書くのは冗長です。これを簡潔に記述するために、<a href="../reference/sqlfile.html#組み込み関数の使用">組み込み関数</a>の「@isNotEmpty」が使用できます。
				@isNotEmptyを使用すると次のように記述できます。
				これは上記のSQLと意味的にはまったく同等です。
			</p>
<div class="source"><pre>select * from employee where /*%if @isNotEmpty(name) */ name = /* name */'hoge' /*%end*/</pre>
</div>
<p>
				使用するDaoのメソッド定義は次のとおりです。
				メソッドの定義は、@isNotEmptyの使用の有無に影響されません。
			</p>
<div class="source"><pre>@Select
List&lt;Employee&gt; selectByNotEmptyName(String name);</pre>
</div>
<p>
				Daoのメソッドは次のように呼び出します。
			</p>
<div class="source"><pre>List&lt;Employee&gt; list = dao.selectByNotEmptyName(&quot;SMITH&quot;);</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee where name = 'SMITH'</pre>
</div>
<p>
				引数にnullや空文字を渡した場合、実行されるSQLは変化します。
			</p>
<div class="source"><pre>list = dao.selectByNotEmptyName(null);</pre>
</div>
<div class="source"><pre>list = dao.selectByNotEmptyName(&quot;&quot;);</pre>
</div>
<p>
				引数にnullや空文字を渡した場合、SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee</pre>
</div>
<p>
				文字シーケンスを扱う組み込み関数には、「@isNotEmpty」の他に、「@isEmpty」、「@isBlank」、「@isNotBlank」があります。
				それぞれの説明については<a href="../reference/sqlfile.html#組み込み関数の使用">組み込み関数</a>を参照してください。
			</p>
</div>
<div class="section"><h2><a name="ドメインによる検索"></a>ドメインによる検索</h2>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestSelectByDomainメソッドを参照してください。
				ドメインを条件に使用した検索です。
			</p>
<p>
				使用するDaoのメソッド定義は次のとおりです。
			</p>
<div class="source"><pre>@Select
List&lt;Employee&gt; selectBySalary(Salary salary);</pre>
</div>
<p>
				Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectBySalary.sqlです。
				SQLは次のように記述されています。
				パラメータの型がドメインクラスであっても、SQLファイルでの扱い方は基本型と変わりません。
			</p>
<div class="source"><pre>select * from employee where salary &gt; /* salary */0</pre>
</div>
<p>
				Daoのメソッドは次のように呼び出します。
			</p>
<div class="source"><pre>List&lt;Employee&gt; list = dao.selectBySalary(new Salary(2900));</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee where salary &gt; 2900</pre>
</div>
</div>
<div class="section"><h2><a name="エンティティによる検索"></a>エンティティによる検索</h2>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestSelectByEntityメソッドを参照してください。
				エンティティを条件に使用した検索です。
			</p>
<p>
				使用するDaoのメソッド定義は次のとおりです。
			</p>
<div class="source"><pre>@Select
List&lt;Employee&gt; selectByExample(Employee e);</pre>
</div>
<p>
				Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectByExample.sqlです。
				SQLは次のように記述されています。
				パラメータの型がエンティティクラスの場合、SQLファイルの中ではドットを使用してエンティティのプロパティにアクセスできます。
			</p>
<div class="source"><pre>select * from employee where name = /* e.name */'aaa'</pre>
</div>
<p>
				Daoのメソッドは次のように呼び出します。
			</p>
<div class="source"><pre>Employee e = new Employee();
e.setName(&quot;SMITH&quot;);
List&lt;Employee&gt; list = dao.selectByExample(e);</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee where name = 'SMITH'</pre>
</div>
</div>
<div class="section"><h2><a name="ページングを行う検索"></a>ページングを行う検索</h2>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestOffsetLimitメソッドを参照してください。
				ページングを行う検索です。
			</p>
<p>
				使用するDaoのメソッド定義は次のとおりです。
				Daoのメソッドでは、SelectOptions型のパラメータを定義します。
			</p>
<div class="source"><pre>@Select
List&lt;Employee&gt; selectAll(SelectOptions options);</pre>
</div>
<p>
				Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectAll.sqlです。
				SQLは次のように記述されています。
				SQLにはORDER BY句の存在が必須です。
			</p>
<div class="source"><pre>select * from employee order by id</pre>
</div>
<p>
				Daoのメソッドは次のように呼び出します。
				SelectOptionsにoffsetとlimitを指定しています。
			</p>
<div class="source"><pre>SelectOptions options = SelectOptions.get().offset(5).limit(3);
List&lt;Employee&gt; list = dao.selectAll(options);
assertEquals(3, list.size());</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee order by id limit 3 offset 5</pre>
</div>
</div>
<div class="section"><h2><a name="ページングと集計を同時に行う検索"></a>ページングと集計を同時に行う検索</h2>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestCountメソッドを参照してください。
				ページングと集計（ページングしない場合の全件数の取得）を同時に行う検索です。
			</p>
<p>
				使用するDaoのメソッド定義は次のとおりです。
				Daoのメソッドでは、SelectOptions型のパラメータを定義します。
			</p>
<div class="source"><pre>@Select
List&lt;Employee&gt; selectAll(SelectOptions options);</pre>
</div>
<p>
				Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectAll.sqlです。
				SQLは次のように記述されています。
				SQLにはORDER BY句の存在が必須です。
			</p>
<div class="source"><pre>select * from employee order by id</pre>
</div>
<p>
				Daoのメソッドは次のように呼び出します。
				SelectOptionsのcountメソッドをあらかじめ呼び出しておきます。
				Daoのメソッドを呼び出した後、SelectOptionsのgetCountメソッドにより集計結果を取得できます。
			</p>
<div class="source"><pre>SelectOptions options = SelectOptions.get().offset(5).limit(3).count();
List&lt;Employee&gt; list = dao.selectAll(options);
assertEquals(3, list.size());
assertEquals(14, options.getCount());</pre>
</div>
<p>
				SQLのログは次のように2つ出力されます。
			</p>
<div class="source"><pre>select * from employee order by id limit 3 offset 5</pre>
</div>
<div class="source"><pre>select count(*) from ( select * from employee ) t_</pre>
</div>
</div>
<div class="section"><h2><a name="イテレーション検索"></a>イテレーション検索</h2>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestIterateメソッドを参照してください。
				SQLの結果セットを1件ずつエンティティなどのオブジェクトへインスタンス化する検索です。
				メモリの使用量を抑えながら大量データを扱う場合に向いています。
			</p>
<p>
				使用するDaoのメソッド定義は次のとおりです。
				@Selectのiterate要素にtrueを指定し、DaoのメソッドではIterationCallback型のパラメータを定義します。
			</p>
<div class="source"><pre>@Select(iterate = true)
&lt;R&gt; R selectByAge(int age, IterationCallback&lt;R, Employee&gt; callback);</pre>
</div>
<p>
				Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectByAge.sqlです。
				SQLは次のように記述されています。
			</p>
<div class="source"><pre>select * from employee where age &gt; /* age */0 order by age</pre>
</div>
<p>
				Daoのメソッドは次のように呼び出します。
			</p>
<div class="source"><pre>Salary sum = dao.selectByAge(30,
        new IterationCallback&lt;Salary, Employee&gt;() {

            private Salary sum = new Salary(0);

                @Override
                public Salary iterate(Employee target,
                        IterationContext context) {
                    Salary salary = target.getSalary();
                    if (salary != null) {
                        sum = sum.add(salary);
                    }
                    return sum;
                }
            });</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select * from employee where age &gt; 30 order by age</pre>
</div>
</div>
<div class="section"><h2><a name="結合した結果を取得する検索"></a>結合した結果を取得する検索</h2>
<p><a class="externalLink" href="https://www.seasar.org/svn/doma/trunk/doma-tutorial/src/test/java/tutorial/SelectTest.java">src/test/java/tutorial/SelectTest.java</a>のtestSelectJoinedResultメソッドを参照してください。
				結合した結果を取得する検索です。
				結合した結果が複数テーブルのカラムを含む場合、取得対象カラムすべてに対応するプロパティをもったエンティティクラスが必要です。
			</p>
<p>
				使用するDaoのメソッド定義は次のとおりです。
			</p>
<div class="source"><pre>@Select
List&lt;EmployeeDepartment&gt; selectAllEmployeeDepartment();</pre>
</div>
<p>
				戻り値のListの要素である<code>EmployeeDepartment</code>が結合した結果に対応するエンティティクラスです。
				このエンティティクラスは、結合のベースとなるテーブルに対応するエンティティクラスを継承すると比較的に簡単に作成できます。
			</p>
<div class="source"><pre>@Entity
public class EmployeeDepartment extends Employee {

    @Column(name = &quot;DEPARTMENT_NAME&quot;)
    String departmentName;

    ...

}</pre>
</div>
<p>
				Daoメソッドに対応するSQLファイルのパスはMETA-INF/tutorial/dao/EmployeeDao/selectAllEmployeeDepartment.sqlです。
				SQLは次のように記述されています。
			</p>
<div class="source"><pre>select
  e.*,
  d.name department_name 
from 
  employee e 
left outer join 
  department d 
on 
  e.department_id = d.id 
order by 
  e.id</pre>
</div>
<p>
				Daoのメソッドは次のように呼び出します。
			</p>
<div class="source"><pre>List&lt;EmployeeDepartment&gt; list = dao.selectAllEmployeeDepartment();</pre>
</div>
<p>
				SQLのログは次のように出力されます。
			</p>
<div class="source"><pre>select
  e.*,
  d.name department_name 
from 
  employee e 
left outer join 
  department d 
on 
  e.department_id = d.id 
order by 
  e.id</pre>
</div>
</div>

</div><!-- article -->

</div><!-- contents_center -->

<div id="footer">
<address>  &copy; Copyright 
                    <a href="http://www.seasarfoundation.org/">The Seasar Foundation</a>.
            and the others
    
              2009-2014,
        all rights reserved.
  <a href="http://www.seasar.org">The Seasar Project</a>.
</address>
<div class="line"><span class="hide">spacer</span></div>
</div><!-- footer -->

</div><!-- wrapper -->

</body>
</html>
